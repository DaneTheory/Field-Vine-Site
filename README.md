For Daniel.

Some code edits and optimization opportunities I noticed.
